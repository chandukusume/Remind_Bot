version: "3.1"

rules:

- rule: Say hello anytime the user greets
  steps:
  - intent: greet
  - action: utter_greet

- rule: Say goodbye anytime the user says goodbye
  steps:
  - intent: goodbye
  - action: utter_goodbye

- rule: Show commands when user asks
  steps:
  - intent: show_commands
  - action: utter_show_commands

- rule: Handle start intent
  steps:
  - intent: start
  - action: utter_start

# ----------------------------------------------------------------------
# MASTER SHEET FORM RULES
# ----------------------------------------------------------------------

- rule: Activate the master sheet form if the ID isn't provided
  steps:
  - intent: set_master_sheet
  - action: master_sheet_form
  - active_loop: master_sheet_form

- rule: Handle submission of the master sheet form
  condition:
  - active_loop: master_sheet_form
  steps:
  - action: master_sheet_form
  - active_loop: null
  - action: action_set_master_sheet

# ----------------------------------------------------------------------
# ACTIVE SHEET FORM RULES
# ----------------------------------------------------------------------

- rule: Activate active sheet form
  steps:
  - intent: set_active_sheet
  - action: active_sheet_form
  - active_loop: active_sheet_form

- rule: Handle submission of the active sheet form
  condition:
  - active_loop: active_sheet_form
  steps:
  - action: active_sheet_form
  - active_loop: null
  - action: action_set_active_sheet

# ----------------------------------------------------------------------
# SCHEDULE TIME FORM RULES
# ----------------------------------------------------------------------

- rule: Activate the time form (Button Click)
  steps:
  - intent: set_schedule_time
  - action: time_form
  - active_loop: time_form

- rule: Handle submission of the time form
  condition:
  - active_loop: time_form
  steps:
  - action: time_form
  - active_loop: null
  - action: action_set_schedule_time

# ----------------------------------------------------------------------
# FORM INTERRUPTION RULES (FIXED YAML VALIDATION ERROR)
# ----------------------------------------------------------------------

- rule: Allow interrupting master_sheet_form with greet
  condition:
  - active_loop: master_sheet_form
  steps:
  - intent: greet
  - action: utter_greet
  - action: action_listen

- rule: Allow interrupting active_sheet_form with greet
  condition:
  - active_loop: active_sheet_form
  steps:
  - intent: greet
  - action: utter_greet
  - action: action_listen

- rule: Allow interrupting time_form with greet
  condition:
  - active_loop: time_form
  steps:
  - intent: greet
  - action: utter_greet
  - action: action_listen

- rule: Allow interrupting master_sheet_form with show_commands
  condition:
  - active_loop: master_sheet_form
  steps:
  - intent: show_commands
  - action: utter_show_commands
  - action: action_listen

- rule: Allow interrupting active_sheet_form with show_commands
  condition:
  - active_loop: active_sheet_form
  steps:
  - intent: show_commands
  - action: utter_show_commands
  - action: action_listen

- rule: Allow interrupting time_form with show_commands
  condition:
  - active_loop: time_form
  steps:
  - intent: show_commands
  - action: utter_show_commands
  - action: action_listen

- rule: Allow get_count even in master_sheet_form
  condition:
  - active_loop: master_sheet_form
  steps:
  - intent: get_count
  - action: action_get_count
  - action: action_listen

- rule: Allow get_count even in active_sheet_form
  condition:
  - active_loop: active_sheet_form
  steps:
  - intent: get_count
  - action: action_get_count
  - action: action_listen

- rule: Allow get_count even in time_form
  condition:
  - active_loop: time_form
  steps:
  - intent: get_count
  - action: action_get_count
  - action: action_listen

- rule: Handle get_count directly
  steps:
  - intent: get_count
  - action: action_get_count

- rule: Handle send_reminder directly
  steps:
  - intent: send_reminder
  - action: action_send_reminder

- rule: Handle check_active_sheet directly
  steps:
  - intent: check_active_sheet
  - action: action_check_active_sheet

- rule: Handle stop_reminder directly
  steps:
  - intent: stop_reminder
  - action: action_stop_reminder

- rule: Handle restart_reminders directly
  steps:
  - intent: restart_reminders
  - action: action_restart_reminders

- rule: Handle schedule_reminder directly
  steps:
  - intent: schedule_reminder
  - action: action_schedule_reminder

- rule: Handle show_info directly
  steps:
  - intent: show_info
  - action: action_show_info